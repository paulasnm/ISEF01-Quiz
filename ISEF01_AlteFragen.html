<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fragenverwaltung</title>
</head>

<body>
  <header>
    <div class="top-nav">
      <a href="ISEF01_Admin.html">Zurück zum Hauptmenü</a>
    </div>
  </header>

  <h1>Fragenverwaltung</h1>

  <section class="toolbar" aria-label="Werkzeuge zur Suche und Aktualisierung">
    <input id="search" type="search" placeholder="Nach Frage oder Kategorie suchen…" aria-label="Suche" />
    <button id="refresh" class="btn" aria-label="Aktualisieren">Aktualisieren ↺</button>
  </section>

  <main class="list" id="list" aria-live="polite" aria-busy="false"></main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <footer>
    <!-- untere Navigation -->
     <div class="bottom-nav">
        <a href="ISEF01_Login.html">Logout</a>
        <a href="ISEF01_Nutzerverwaltung.html">Nutzerverwaltung</a>
        <a href="ISEF01_Fragenkatalog.html">Fragenkatalog</a>
        <a href="ISEF01_AGB.html">AGB &amp; Impressum</a>
     </div>
    </footer>
</body>
</html>

<style>
  .top-nav {
    text-align: right;
    padding: 8px 16px;
    margin-right: 30px;
    margin-top: 10px;
    font-size: 0.9rem;
  }

  .top-nav a {
    color: white;
    text-decoration: none;
  }

  .top-nav a:hover {
    text-decoration: underline;
  }

  :root {
    --gap: 28px;
  }

  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow-x: hidden;
  }

  body {
    padding: 0 24px;
    min-height: 100vh;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    background-image: url("Die Schatzinsel2.jpeg");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    gap: var(--gap);
  }

  h1 {
    margin-top: 50px;
    font-size: 250% !important;
    font-weight: bold;
    text-align: center;
    font-family: "IM FELL Englisch", serif;
    text-decoration: underline;
  }

  /* Toolbar */
  .toolbar {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 12px;
    align-items: center;
    max-width: 1000px;
    margin: 0 auto;
    width: 100%;
  }

  .toolbar input[type="search"] {
    width: 100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.25);
    background: rgba(0,0,0,0.35);
    color: #fff;
    outline: none;
    backdrop-filter: blur(2px);
  }

  .toolbar button {
    padding: 10px 12px;
  }

  /* Fragenliste */
  .list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--gap);
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
  }

  .card {
    background: rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 16px;
    padding: 16px;
    display: grid;
    gap: 10px;
    backdrop-filter: blur(2px);
    transition: transform .15s ease, box-shadow .15s ease;
  }

  .card:hover { 
    transform: translateY(-3px); 
    box-shadow: 0 10px 20px rgba(0,0,0,.25); 
  }

  .card h3 {
    margin: 0;
    font-size: clamp(1.1rem, 2.2vw, 1.4rem);
  }

  .meta {
    font-size: 0.9rem;
    opacity: 0.9;
  }

  /* Buttons im gleichen Stil wie Quizverwaltung */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.25);
    background: rgba(0,0,0,0.35);
    color: #fff;
    padding: 10px 12px;
    cursor: pointer;
    user-select: none;
    transition: transform .08s ease, background .15s ease;
    backdrop-filter: blur(2px);
    font-size: 0.95rem;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    text-decoration: underline;
  }

  .btn:active { transform: translateY(1px); }

  .btn-delete { border-color: rgba(255,0,0,0.35); }

  /* Toast */
  .toast {
    position: fixed;
    left: 50%;
    bottom: 24px;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.8);
    border: 1px solid rgba(255,255,255,0.25);
    color: #fff;
    padding: 12px 16px;
    border-radius: 12px;
    z-index: 9999;
    display: none;
  }

/*Position und Design untere Navigation*/
footer {
    margin-top: auto; 
    padding: 16px 0;
    font-family: "Inter", sans-serif;
    font-size: larger;
    margin-bottom: 20px;
}

.bottom-nav {
    width: 100%;
    display: flex;
    justify-content: space-around;
    font-size: 1.2em;
}

.bottom-nav a {
    color: white;
    text-decoration: none;
    transition: color 0.2s;
}

.bottom-nav a:hover {
    color: #ccc;
}


  @media (max-width: 600px) {
    h1 { font-size: 1.4em; }
    .toolbar { grid-template-columns: 1fr; }
  }

  @media (min-width: 601px) and (max-width: 1024px) {
    h1 { font-size: 1.8em; }
  }
</style>

<script>
  const listEl = document.getElementById('list');
  const searchEl = document.getElementById('search');
  const refreshEl = document.getElementById('refresh');
  const toastEl = document.getElementById('toast');

  /** Demo-Daten */
  const demoQuestions = [
    { id: 'q1', text: 'Wer hat "Die Schatzinsel" geschrieben?', category: 'Literatur' },
    { id: 'q2', text: 'Was ist die Hauptstadt von Frankreich?', category: 'Geografie' },
    { id: 'q3', text: '2 + 2 * 2 = ?', category: 'Mathematik' }
  ];

  function loadFromLocal() {
    const raw = localStorage.getItem('frage_admin_demo');
    if (raw) return JSON.parse(raw);
    localStorage.setItem('frage_admin_demo', JSON.stringify(demoQuestions));
    return demoQuestions;
  }

  function saveToLocal(data) {
    localStorage.setItem('frage_admin_demo', JSON.stringify(data));
  }

  function render(questions) {
    listEl.innerHTML = '';
    if (!questions.length) {
      const empty = document.createElement('div');
      empty.className = 'card';
      empty.innerHTML = '<p>Keine Fragen gefunden.</p>';
      listEl.appendChild(empty);
      return;
    }

    for (const q of questions) {
      const card = document.createElement('article');
      card.className = 'card';
      card.setAttribute('data-id', q.id);

      card.innerHTML = `
        <h3>${escapeHtml(q.text)}</h3>
        <div class="meta">Kategorie: ${escapeHtml(q.category)}</div>
        <div class="actions">
          <button class="btn btn-delete" data-action="delete">✗ Löschen</button>
        </div>
      `;

      card.addEventListener('click', async (e) => {
        const btn = e.target.closest('button[data-action]');
        if (!btn) return;
        if (btn.dataset.action === 'delete') {
          const ok = confirm(`Frage wirklich löschen?\n\n"${q.text}"`);
          if (!ok) return;
          await deleteQuestion(q.id);
        }
      });

      listEl.appendChild(card);
    }
  }

  function escapeHtml(str) {
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  function getFiltered() {
    const all = loadFromLocal();
    const search = searchEl.value.trim().toLowerCase();
    return all.filter(q => {
      const matchesSearch = !search || [q.text, q.category].join(' ').toLowerCase().includes(search);
      return matchesSearch;
    });
  }

  async function deleteQuestion(id) {
    let data = loadFromLocal();
    data = data.filter(q => q.id !== id);
    saveToLocal(data);
    showToast('Frage gelöscht.');
    refreshList();
  }

  function showToast(msg) {
    toastEl.textContent = msg;
    toastEl.style.display = 'block';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => { toastEl.style.display = 'none'; }, 2000);
  }

  function refreshList() {
    listEl.setAttribute('aria-busy', 'true');
    render(getFiltered());
    listEl.setAttribute('aria-busy', 'false');
  }

  // Events
  searchEl.addEventListener('input', refreshList);
  refreshEl.addEventListener('click', refreshList);

  // Initial
  refreshList();
</script>
